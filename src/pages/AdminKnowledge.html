<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snow Media AI Knowledge Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #1e293b 0%, #1e40af 50%, #1e293b 100%);
            min-height: 100vh;
        }
    </style>
</head>
<body class="text-white">
    <div class="min-h-screen p-8">
        <div class="max-w-4xl mx-auto">
            <div class="text-center mb-8">
                <h1 class="text-4xl font-bold text-white mb-2">Snow Media AI Knowledge Manager</h1>
                <p class="text-xl text-blue-200">Upload documents to train the AI assistant</p>
            </div>

            <div class="bg-slate-800 rounded-lg p-8 border border-slate-700">
                <form id="uploadForm" class="space-y-6">
                    <!-- API Key -->
                    <div class="space-y-2">
                        <label class="text-white text-lg block">API Key</label>
                        <input
                            id="apiKey"
                            type="password"
                            placeholder="Enter your EXTERNAL_KNOWLEDGE_API_KEY"
                            class="w-full bg-slate-700 border border-slate-600 text-white rounded-lg p-3"
                        />
                        <p class="text-sm text-slate-400">
                            This is the secret key you set in Supabase Edge Function Secrets
                        </p>
                    </div>

                    <!-- File Upload -->
                    <div class="space-y-2">
                        <label class="text-white text-lg block">Upload Document</label>
                        <div class="border-2 border-dashed border-slate-600 rounded-lg p-6 text-center">
                            <input
                                id="fileInput"
                                type="file"
                                accept=".txt,.pdf,.doc,.docx"
                                class="hidden"
                            />
                            <label for="fileInput" class="cursor-pointer flex flex-col items-center space-y-2">
                                <svg class="w-8 h-8 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                                </svg>
                                <span class="text-white">Click to upload file</span>
                                <span class="text-sm text-slate-400">Supported: TXT, PDF, DOC, DOCX</span>
                            </label>
                        </div>
                    </div>

                    <!-- Title -->
                    <div class="space-y-2">
                        <label class="text-white text-lg block">Document Title</label>
                        <input
                            id="title"
                            type="text"
                            placeholder="e.g., How to Install Streaming Apps"
                            class="w-full bg-slate-700 border border-slate-600 text-white rounded-lg p-3"
                        />
                    </div>

                    <!-- Description -->
                    <div class="space-y-2">
                        <label class="text-white text-lg block">Description (Optional)</label>
                        <input
                            id="description"
                            type="text"
                            placeholder="Brief description of the document"
                            class="w-full bg-slate-700 border border-slate-600 text-white rounded-lg p-3"
                        />
                    </div>

                    <!-- Category -->
                    <div class="space-y-2">
                        <label class="text-white text-lg block">Category</label>
                        <select id="category" class="w-full bg-slate-700 border border-slate-600 text-white rounded-lg p-3">
                            <option value="general">General Information</option>
                            <option value="streaming-apps">Streaming Apps</option>
                            <option value="android-tv">Android TV</option>
                            <option value="tutorials">Tutorials</option>
                            <option value="troubleshooting">Troubleshooting</option>
                            <option value="installation-guides">Installation Guides</option>
                        </select>
                    </div>

                    <!-- Content -->
                    <div class="space-y-2">
                        <label class="text-white text-lg block">Content</label>
                        <textarea
                            id="content"
                            placeholder="Enter your knowledge content here or upload a file above..."
                            class="w-full bg-slate-700 border border-slate-600 text-white rounded-lg p-3 h-40"
                        ></textarea>
                    </div>

                    <!-- Submit Button -->
                    <button
                        type="submit"
                        id="submitBtn"
                        class="w-full bg-blue-600 hover:bg-blue-700 text-white text-lg py-3 rounded-lg transition-colors"
                    >
                        Upload to Knowledge Base
                    </button>
                </form>

                <!-- Status Messages -->
                <div id="statusMessage" class="mt-4 p-4 rounded-lg hidden"></div>
            </div>

            <!-- Instructions -->
            <div class="bg-slate-800 rounded-lg p-6 border border-slate-700 mt-8">
                <h3 class="text-xl font-bold text-white mb-4">Instructions</h3>
                <div class="space-y-3 text-slate-300">
                    <div class="flex items-start space-x-3">
                        <svg class="w-5 h-5 text-green-400 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                        </svg>
                        <p>Upload documents that contain information you want the AI to use when helping customers</p>
                    </div>
                    <div class="flex items-start space-x-3">
                        <svg class="w-5 h-5 text-green-400 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                        </svg>
                        <p>Choose appropriate categories to help the AI find relevant information</p>
                    </div>
                    <div class="flex items-start space-x-3">
                        <svg class="w-5 h-5 text-green-400 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                        </svg>
                        <p>Updates are immediate - the AI will use new documents right away</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const fileInput = document.getElementById('fileInput');
        const titleInput = document.getElementById('title');
        const contentTextarea = document.getElementById('content');
        const uploadForm = document.getElementById('uploadForm');
        const submitBtn = document.getElementById('submitBtn');
        const statusMessage = document.getElementById('statusMessage');

        // Handle file upload
        fileInput.addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (!file) return;

            // Check file type
            const allowedTypes = ['text/plain', 'application/pdf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'];
            if (!allowedTypes.includes(file.type)) {
                showStatus('Invalid file type. Please upload a TXT, PDF, DOC, or DOCX file.', 'error');
                return;
            }

            // Read file content (for text files)
            if (file.type === 'text/plain') {
                const reader = new FileReader();
                reader.onload = function(e) {
                    contentTextarea.value = e.target.result;
                    if (!titleInput.value) {
                        titleInput.value = file.name.replace(/\.[^/.]+$/, "");
                    }
                };
                reader.readAsText(file);
            } else {
                // For other file types, just set the filename
                if (!titleInput.value) {
                    titleInput.value = file.name.replace(/\.[^/.]+$/, "");
                }
                contentTextarea.value = `File uploaded: ${file.name}\nFile type: ${file.type}\nFile size: ${(file.size / 1024).toFixed(2)} KB\n\nNote: Content will be extracted during processing.`;
            }
        });

        // Handle form submission
        uploadForm.addEventListener('submit', async function(event) {
            event.preventDefault();

            const apiKey = document.getElementById('apiKey').value;
            const title = document.getElementById('title').value;
            const description = document.getElementById('description').value;
            const category = document.getElementById('category').value;
            const content = document.getElementById('content').value;

            if (!apiKey) {
                showStatus('Please enter your API key.', 'error');
                return;
            }

            if (!title || !content) {
                showStatus('Please provide both title and content.', 'error');
                return;
            }

            // Show loading
            submitBtn.textContent = 'Uploading...';
            submitBtn.disabled = true;

            try {
                const response = await fetch('https://falmwzhvxoefvkfsiylp.functions.supabase.co/external-knowledge-sync', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        apiKey: apiKey,
                        action: 'create',
                        title: title,
                        description: description,
                        category: category,
                        content: content,
                        file_type: 'text'
                    }),
                });

                const result = await response.json();

                if (result.success) {
                    showStatus(`Document "${title}" uploaded successfully!`, 'success');
                    // Reset form
                    uploadForm.reset();
                    contentTextarea.value = '';
                } else {
                    throw new Error(result.error || 'Upload failed');
                }
            } catch (error) {
                console.error('Upload error:', error);
                showStatus(`Upload failed: ${error.message}`, 'error');
            } finally {
                submitBtn.textContent = 'Upload to Knowledge Base';
                submitBtn.disabled = false;
            }
        });

        function showStatus(message, type) {
            statusMessage.textContent = message;
            statusMessage.className = `mt-4 p-4 rounded-lg ${type === 'success' ? 'bg-green-600 text-white' : 'bg-red-600 text-white'}`;
            statusMessage.classList.remove('hidden');
            
            // Hide after 5 seconds
            setTimeout(() => {
                statusMessage.classList.add('hidden');
            }, 5000);
        }
    </script>
</body>
</html>